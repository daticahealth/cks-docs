### Pod Security Policies
With the release of Kubernetes v1.15, CKS supports enabling the PodSecurityPolicies admission controller. Pod Security Policies provide a way for cluster admins to define a set of security criteria that a pod must meet in order to be accepted by the system. These include things like restricting the users a container can run as, allowing different types of volume mounts (secrets, configmaps, hostPath, etc.), and using the host network. A full list of available controls can be found [here](https://kubernetes.io/docs/concepts/policy/pod-security-policy/#what-is-a-pod-security-policy).

CKS creates a default Pod Security Policy that is bound to all ServiceAccounts, meaining any Pod can use it out of the box. The default PSP requires that all containers run as non-root, and does not allow privileged containers or any special capabilities, like CAP_NET_ADMIN. Any pod that meets these criteria will be admitted automatically without additional configuration. Pods that do not match the default criteria will need to be explicitly granted permission to use a PSP that allows the required priviledges. To use a PSP, a pod's ServiceAccount needs to be granted the `use` verb on the PSP resource [via RBAC](https://kubernetes.io/docs/concepts/policy/pod-security-policy/#via-rbac).

A pod that is allowed to use multiple PSPs will follow [this policy order](https://kubernetes.io/docs/concepts/policy/pod-security-policy/#policy-order) to choose between them. Once a pod is created, its PSP will not change. The pod does not get permissions from all PSPs that it is allowed to use, it selects one PSP and must conform to its rules in order to be admitted to the cluster. This can cause some unexpected behavior in certain situations when a pod has implicit requirements not specified in the initial pod YAML.

For instance, if a pod is allowed to use the default and privileged policies and the image runs as root then it should be assigned the privileged policy. However, if the pod does not explicitly define that it wants to run as root by setting `runAsUser: 0`, and has no other requirements that disqualify default,then it will be admitted under the default policy. When this happens the pod will be created, but the container will fail with the error CreateContainerConfigError because it has violated the rules of its PSP. In order to use the correct PSP, the pod would need to either explicitly define the user it will run as, or request some other elevated permission that would force the pod to be admitted under the privileged policy (such as mounting a host path, or running a privileged container).

Pod Security Policies are an advanced security feature of Kubernetes, and are not enabled by default. In order to enable PSPs for your CKS cluster please reach out to Datica support by submitting a ticket through the [Platform dashboard](https://product.datica.com). We will enable the feature on your staging cluster first, and enable it in production when you indicate that you are ready.